<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shark UI</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: transparent;
    color: white;
  }
  #menu {
    width: 360px;
    background: rgba(0,0,0,0.18);
    border: 2px solid #1e5fff;
    display: flex;
    flex-direction: column;
  }
  .menu-title {
    background: rgba(0,0,0,0.85);
    padding: 10px 20px;
    font-weight: bold;
  }
  .menu-item, .submenu-item {
    padding: 10px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    cursor: default;
  }
  .active {
    background: rgba(30,95,255,0.75);
  }
  .toggled::after {
    content: " ✓";
    color: lime;
  }
</style>
</head>
<body>
  <div id="menu">
    <div class="menu-title" id="menuTitle">Main menu</div>
    <div id="mainItems"></div>
    <div id="subMenu" style="display:none;">
      <div id="subItems"></div>
    </div>
  </div>

<script>
let mainItems = [];
let submenuItems = [];
let toggleStates = {};

// HTML-seitiges Update für aktives Element
function highlightActive(items, idx) {
  items.forEach((el,i) => el.classList.toggle('active', i === idx));
}

// Toggle-Anzeige updaten
function updateToggleUI(el, state) {
  el.classList.toggle('toggled', state);
}

// DUI-Nachrichten aus Lua
window.addEventListener('message', (event) => {
  const d = event.data;
  switch(d.type) {
    case 'setTitle':
      document.getElementById('menuTitle').textContent = d.text;
      break;
    case 'selectIndex':
      highlightActive(mainItems, d.index);
      break;
    case 'openSubmenu':
      document.getElementById('subMenu').style.display = 'block';
      break;
    case 'closeSubmenu':
      document.getElementById('subMenu').style.display = 'none';
      break;
    case 'setSubmenu':
      const subItemsDiv = document.getElementById('subItems');
      subItemsDiv.innerHTML = '';
      submenuItems = d.items.map((name) => {
        const el = document.createElement('div');
        el.className = 'submenu-item';
        el.dataset.feature = name;
        el.textContent = name;
        subItemsDiv.appendChild(el);
        return el;
      });
      break;
    case 'selectSub':
      highlightActive(submenuItems, d.index);
      break;
    case 'featureState':
      toggleStates[d.name] = !!d.state;
      const el = submenuItems.find(x => x.dataset.feature === d.name);
      if (el) updateToggleUI(el, !!d.state);
      break;
    case 'initMain':
      const mainDiv = document.getElementById('mainItems');
      mainDiv.innerHTML = '';
      mainItems = d.items.map((name) => {
        const el = document.createElement('div');
        el.className = 'menu-item';
        el.textContent = name;
        mainDiv.appendChild(el);
        return el;
      });
      break;
  }
});
</script>
</body>
</html>
