<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shark Menu</title>
<style>
html, body{
  margin:0; padding:0;
  background:transparent;
  overflow:hidden;
  width:800px;
  height:600px;
  font-family: Arial, sans-serif;
}
.overlay{
  position:absolute; top:0; left:0;
  pointer-events:none;
}
.menu { width:360px; background:rgba(0,0,0,.18); color:#fff;
  display:flex; flex-direction:column; border:2px solid #666; border-radius:10px; overflow:hidden; }
.menu-header img{ width:100%; height:auto; display:block; }
.menu-title{ background:rgba(0,0,0,.85); padding:8px 20px; font-weight:700; }
.menu-section{ background:rgba(0,0,0,.35); flex-grow:1; overflow-y:auto; }
.menu-item{ padding:10px 20px; display:flex; justify-content:space-between;
  border-bottom:1px solid rgba(255,255,255,.08); cursor:default; }
.menu-item.active{ background:#000; color:#fff; }
.submenu{ display:none; flex-direction:column; background:rgba(0,0,0,.45); overflow-y:auto; }
.submenu-item{ padding:10px 20px; display:flex; justify-content:space-between;
  border-bottom:1px solid rgba(255,255,255,.08); }
.submenu-item.active{ background:rgba(128,128,128,.35); color:#fff; }

/* Toggle Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 18px;
}
.switch input { display:none; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #555;
  transition: .2s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 14px; width: 14px;
  left: 2px; bottom: 2px;
  background-color: white;
  transition: .2s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4ade80;
}
input:checked + .slider:before {
  transform: translateX(16px);
}

/* Button Dot */
.dot {
  width:10px; height:10px;
  background:#aaa;
  border-radius:50%;
  display:inline-block;
}
.menu-footer{ background:rgba(0,0,0,.85); padding:6px 10px; font-size:11px; display:flex; justify-content:space-between; }
</style>
</head>
<body>
<div class="overlay">
  <div class="menu">
    <div class="menu-header">
      <img src="https://cdn.discordapp.com/attachments/1366488328773439551/1403671888936435722/image.png" alt="Banner">
    </div>
    <div class="menu-title" id="menuTitle">Main menu</div>
    <div class="menu-section" id="mainMenu">
      <div class="menu-item" data-title="Self">Self <span>></span></div>
      <div class="menu-item" data-title="Server">Server <span>></span></div>
      <div class="menu-item" data-title="Weapon">Weapon <span>></span></div>
      <div class="menu-item" data-title="Combat">Combat <span>></span></div>
      <div class="menu-item" data-title="Vehicle">Vehicle <span>></span></div>
      <div class="menu-item" data-title="Visual">Visual <span>></span></div>
      <div class="menu-item" data-title="Misc">Misc <span>></span></div>
      <div class="menu-item" data-title="Settings">Settings <span>></span></div>
    </div>
    <div class="menu-section submenu" id="submenu"></div>
    <div class="menu-footer">
      <div>Build: 1.2</div>
      <div id="pageCounter">1 / 8</div>
    </div>
  </div>
</div>

<script>
const toggleStates = {};
const items = [...document.querySelectorAll('.menu-item')];
const submenu = document.getElementById('submenu');
let submenuItems = [];
const menuTitle = document.getElementById('menuTitle');
const mainMenu = document.getElementById('mainMenu');
const pageCounter = document.getElementById('pageCounter');
let index = 0, subIndex = 0;

function updateSelection(){
  items.forEach((el,i)=>el.classList.toggle('active', i===index));
  pageCounter.textContent = `${index+1} / ${items.length}`;
}
function updateSubSelection(){
  submenuItems.forEach((el,i)=>el.classList.toggle('active', i===subIndex));
}
updateSelection();

function updateToggleUI(el, state) {
  const input = el.querySelector("input[type=checkbox]");
  if (input) input.checked = state;
}

function sendToggle(feature, state) {
  const msg = { type:"toggleFeature", feature, state };
  window.parent.postMessage(msg, "*");
}

// Eingaben
document.addEventListener('keydown', e=>{
  const inSub = getComputedStyle(submenu).display !== 'none';
  if (!inSub){
    if (e.key==='ArrowDown'){ index=(index+1)%items.length; updateSelection(); }
    else if (e.key==='ArrowUp'){ index=(index-1+items.length)%items.length; updateSelection(); }
    else if (e.key==='Enter'){
      const title = items[index].dataset.title;
      menuTitle.textContent = title;
      mainMenu.style.display='none';
      submenu.style.display='flex';
      subIndex=0; updateSubSelection();
    }
  } else {
    if (e.key==='Backspace'){
      submenu.style.display='none'; mainMenu.style.display='block';
      menuTitle.textContent='Main menu'; updateSelection();
    }
    else if (e.key==='ArrowDown'){ subIndex=(subIndex+1)%submenuItems.length; updateSubSelection(); }
    else if (e.key==='ArrowUp'){ subIndex=(subIndex-1+submenuItems.length)%submenuItems.length; updateSubSelection(); }
    else if (e.key==='Enter'){
      const el = submenuItems[subIndex];
      const feature = el.dataset.feature;
      const type = el.dataset.type;

      if (type === "toggle") {
        toggleStates[feature] = !toggleStates[feature];
        updateToggleUI(el, toggleStates[feature]);
        sendToggle(feature, toggleStates[feature]);
      } else {
        sendToggle(feature, true); // Button nur einmal triggern
      }
    }
  }
});

// Nachrichten von Lua
window.addEventListener("message", function(ev) {
  const d = ev.data || {};
  if (!d.type) return;

  switch(d.type){
    case 'setTitle': menuTitle.textContent = d.text || 'Main menu'; break;
    case 'selectIndex': index = Math.max(0, Math.min(items.length-1, Number(d.index)||0)); updateSelection(); break;
    case 'openSubmenu': mainMenu.style.display='none'; submenu.style.display='flex'; subIndex=0; updateSubSelection(); break;
    case 'closeSubmenu': submenu.style.display='none'; mainMenu.style.display='block'; menuTitle.textContent='Main menu'; updateSelection(); break;

    case 'setSubmenu': {
      const arr = Array.isArray(d.items) ? d.items : [];
      const states = d.states || {};
      submenu.innerHTML = arr.map((f,i)=>{
        const isToggle = states.hasOwnProperty(f); // Lua gibt state nur f√ºr Toggles
        if (isToggle) {
          const state = !!states[f];
          toggleStates[f] = state;
          return `<div class="submenu-item${i===0?' active':''}" data-feature="${f}" data-type="toggle">
                    <span>${f}</span>
                    <label class="switch">
                      <input type="checkbox" ${state?'checked':''}>
                      <span class="slider"></span>
                    </label>
                  </div>`;
        } else {
          return `<div class="submenu-item${i===0?' active':''}" data-feature="${f}" data-type="button">
                    <span>${f}</span>
                    <span class="dot"></span>
                  </div>`;
        }
      }).join("");
      submenuItems = [...document.querySelectorAll(".submenu-item")];
      subIndex=0; updateSubSelection();
      break;
    }

    case 'selectSub': {
      const n = submenuItems.length;
      subIndex = Math.max(0, Math.min(n-1, Number(d.index)||0));
      updateSubSelection();
      break;
    }
    case 'featureState': {
      const name = String(d.name||'');
      const state = !!d.state;
      toggleStates[name] = state;
      const el = [...submenuItems].find(x=>x.dataset.feature===name);
      if (el) updateToggleUI(el, state);
      break;
    }
  }
});
</script>
</body>
</html>
